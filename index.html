<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Workout Tracker</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #f2f2f7;
}
header {
  padding: 16px;
  font-size: 20px;
  font-weight: 600;
  text-align: center;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
nav {
  display: flex;
  background: white;
  position: fixed;
  bottom: 0;
  width: 100%;
  border-top: 1px solid #ddd;
}
nav button {
  flex: 1;
  padding: 14px;
  background: none;
  border: none;
  font-size: 14px;
}
section {
  padding: 16px;
  padding-bottom: 80px;
}
.card {
  background: white;
  padding: 14px;
  margin-bottom: 12px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
button.primary {
  background: #2f6df6;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 8px;
  width: 100%;
  margin-top: 8px;
}
button.secondary {
  background: #e5e5ea;
  border: none;
  padding: 8px;
  border-radius: 8px;
  width: 100%;
  margin-top: 6px;
}
input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
.set-row {
  display: flex;
  gap: 6px;
  margin-top: 6px;
}
.set-row input {
  flex: 1;
}
.hidden { display: none; }
.small { font-size: 12px; color: gray; }
</style>
</head>
<body>

<header>Workout Tracker</header>

<section id="exercises"></section>
<section id="workouts" class="hidden"></section>
<section id="start" class="hidden"></section>
<section id="progress" class="hidden"></section>

<nav>
<button onclick="showTab('exercises')">Exercises</button>
<button onclick="showTab('workouts')">Workouts</button>
<button onclick="showTab('start')">Start</button>
<button onclick="showTab('progress')">Progress</button>
</nav>

<script>
let exercises = JSON.parse(localStorage.getItem('exercises')) || [];
let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
let sessions = JSON.parse(localStorage.getItem('sessions')) || [];
let activeSession = null;

function save() {
  localStorage.setItem('exercises', JSON.stringify(exercises));
  localStorage.setItem('workouts', JSON.stringify(workouts));
  localStorage.setItem('sessions', JSON.stringify(sessions));
}

function showTab(id) {
  document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id === "exercises") renderExercises();
  if(id === "workouts") renderWorkouts();
  if(id === "start") renderStart();
  if(id === "progress") renderProgress();
}

/* ================= EXERCISES ================= */

function renderExercises() {
  const container = document.getElementById('exercises');
  container.innerHTML = `
    <div class="card">
      <h3>Add Exercise</h3>
      <input id="exName" placeholder="Name">
      <button class="primary" onclick="addExercise()">Add</button>
    </div>
  `;
  exercises.forEach(e => {
    container.innerHTML += `
      <div class="card">
        <strong>${e.name}</strong>
        <button class="secondary" onclick="deleteExercise('${e.id}')">Delete</button>
      </div>
    `;
  });
}

function addExercise() {
  const name = document.getElementById('exName').value;
  if(!name) return;
  exercises.push({ id: Date.now().toString(), name });
  save();
  renderExercises();
}

function deleteExercise(id) {
  exercises = exercises.filter(e => e.id !== id);
  save();
  renderExercises();
}

/* ================= WORKOUTS ================= */

function renderWorkouts() {
  const container = document.getElementById('workouts');
  container.innerHTML = `
    <div class="card">
      <h3>Create Workout</h3>
      <input id="workoutName" placeholder="Workout Name">
      <button class="primary" onclick="createWorkout()">Create</button>
    </div>
  `;
  workouts.forEach(w => {
    container.innerHTML += `
      <div class="card">
        <strong>${w.name}</strong>
      </div>
    `;
  });
}

function createWorkout() {
  const name = document.getElementById('workoutName').value;
  if(!name) return;
  workouts.push({
    id: Date.now().toString(),
    name,
    exercises: exercises.map(e => e.id)
  });
  save();
  renderWorkouts();
}

/* ================= START WORKOUT ================= */

function renderStart() {
  const container = document.getElementById('start');
  container.innerHTML = "";

  if(activeSession) {
    renderActiveSession();
    return;
  }

  workouts.forEach(w => {
    container.innerHTML += `
      <div class="card">
        <strong>${w.name}</strong>
        <button class="primary" onclick="startWorkout('${w.id}')">Start</button>
      </div>
    `;
  });
}

function startWorkout(id) {
  const workout = workouts.find(w => w.id === id);
  activeSession = {
    id: Date.now().toString(),
    workoutId: id,
    date: new Date().toISOString(),
    logs: workout.exercises.map(exId => ({
      exerciseId: exId,
      sets: []
    }))
  };
  renderActiveSession();
}

function renderActiveSession() {
  const container = document.getElementById('start');
  const workout = workouts.find(w => w.id === activeSession.workoutId);
  container.innerHTML = `<h3>${workout.name}</h3>`;

  activeSession.logs.forEach((log, index) => {
    const exercise = exercises.find(e => e.id === log.exerciseId);
    container.innerHTML += `
      <div class="card">
        <strong>${exercise?.name || "Exercise"}</strong>
        <div id="sets-${index}"></div>
        <button class="secondary" onclick="addSet(${index})">Add Set</button>
      </div>
    `;
    renderSets(index);
  });

  container.innerHTML += `
    <button class="primary" onclick="finishWorkout()">Finish Workout</button>
  `;
}

function renderSets(logIndex) {
  const log = activeSession.logs[logIndex];
  const container = document.getElementById(`sets-${logIndex}`);
  container.innerHTML = "";

  log.sets.forEach((set, setIndex) => {
    container.innerHTML += `
      <div class="set-row">
        <input type="number" placeholder="Weight"
          value="${set.weight || ""}"
          oninput="updateSet(${logIndex},${setIndex},'weight',this.value)">
        <input type="number" placeholder="Reps"
          value="${set.reps || ""}"
          oninput="updateSet(${logIndex},${setIndex},'reps',this.value)">
      </div>
    `;
  });
}

function addSet(logIndex) {
  activeSession.logs[logIndex].sets.push({ weight:"", reps:"" });
  renderActiveSession();
}

function updateSet(logIndex,setIndex,key,value){
  activeSession.logs[logIndex].sets[setIndex][key]=value;
}

function finishWorkout() {
  sessions.push(activeSession);
  save();
  activeSession = null;
  alert("Workout saved.");
  renderStart();
}

/* ================= PROGRESS ================= */

function renderProgress() {
  const container = document.getElementById('progress');
  container.innerHTML = `
    <div class="card">
      Total Sessions: ${sessions.length}
    </div>
  `;
}

showTab('exercises');
</script>

</body>
</html>